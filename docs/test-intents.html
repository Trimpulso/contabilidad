<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Testing Intents CAI - Chatbot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .test-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .test-card .intent-label {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .test-card .questions {
            margin-bottom: 15px;
        }

        .test-card .question {
            background: #f5f5f5;
            padding: 10px;
            margin: 8px 0;
            border-left: 3px solid #667eea;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .test-card .question:hover {
            background: #efefef;
        }

        .test-card button {
            width: 100%;
            padding: 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        .test-card button:hover {
            background: #5568d3;
        }

        .test-card button:active {
            transform: scale(0.98);
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.loading {
            background: #cfe2ff;
            color: #084298;
            border: 1px solid #b6d4fe;
        }

        .status.error {
            background: #f8d7da;
            color: #842029;
            border: 1px solid #f5c2c7;
        }

        .chat-preview {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .chat-preview h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .chat-window {
            border: 1px solid #ddd;
            border-radius: 8px;
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            background: #f9f9f9;
            margin-bottom: 15px;
        }

        .message {
            margin: 10px 0;
            padding: 12px;
            border-radius: 8px;
            max-width: 80%;
        }

        .message.user {
            background: #667eea;
            color: white;
            margin-left: auto;
            text-align: right;
        }

        .message.bot {
            background: #e9ecef;
            color: #333;
            margin-right: auto;
        }

        .input-area {
            display: flex;
            gap: 10px;
        }

        .input-area input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
        }

        .input-area button {
            padding: 12px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .results-summary {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .results-summary h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .result-item {
            padding: 12px;
            margin: 10px 0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .result-item.pass {
            background: #d4edda;
            color: #155724;
        }

        .result-item.fail {
            background: #f8d7da;
            color: #842029;
        }

        .result-icon {
            font-size: 1.5em;
        }

        .info-box {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            color: white;
            margin-bottom: 20px;
        }

        .loading-spinner {
            display: inline-block;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Testing CAI - Chatbot Inteligente</h1>
            <p>Valida que los 5 intents responden correctamente</p>
        </div>

        <div class="info-box">
            <strong>‚ÑπÔ∏è Instrucciones:</strong> Haz click en cualquier bot√≥n de abajo para probar un intent. 
            Los resultados aparecer√°n en tiempo real. Luego prueba en el chat interactivo.
        </div>

        <div class="test-grid">
            <!-- Test 1: Riesgo Cr√≠tico -->
            <div class="test-card">
                <h3>‚ö†Ô∏è Riesgo Cr√≠tico</h3>
                <span class="intent-label">Intent #1</span>
                <div class="questions">
                    <div class="question" onclick="testIntent('¬øCu√°ntas facturas en riesgo cr√≠tico?')">
                        "¬øCu√°ntas facturas en riesgo cr√≠tico?"
                    </div>
                    <div class="question" onclick="testIntent('Mu√©strame cr√≠ticos')">
                        "Mu√©strame cr√≠ticos"
                    </div>
                    <div class="question" onclick="testIntent('¬øHay bloqueados?')">
                        "¬øHay bloqueados?"
                    </div>
                </div>
                <button onclick="testIntent('¬øCu√°ntas facturas en riesgo cr√≠tico?')">üß™ Probar Intent 1</button>
                <div id="status-1" class="status" style="display: none;"></div>
            </div>

            <!-- Test 2: Deuda Total -->
            <div class="test-card">
                <h3>üí∞ Deuda Total</h3>
                <span class="intent-label">Intent #2</span>
                <div class="questions">
                    <div class="question" onclick="testIntent('¬øCu√°l es la deuda total?')">
                        "¬øCu√°l es la deuda total?"
                    </div>
                    <div class="question" onclick="testIntent('¬øCu√°nto debo?')">
                        "¬øCu√°nto debo?"
                    </div>
                    <div class="question" onclick="testIntent('Deuda pendiente')">
                        "Deuda pendiente"
                    </div>
                </div>
                <button onclick="testIntent('¬øCu√°l es la deuda total?')">üß™ Probar Intent 2</button>
                <div id="status-2" class="status" style="display: none;"></div>
            </div>

            <!-- Test 3: Excepciones -->
            <div class="test-card">
                <h3>‚ö†Ô∏è Excepciones</h3>
                <span class="intent-label">Intent #3</span>
                <div class="questions">
                    <div class="question" onclick="testIntent('¬øCu√°ntas excepciones?')">
                        "¬øCu√°ntas excepciones?"
                    </div>
                    <div class="question" onclick="testIntent('Excepciones aprobadas')">
                        "Excepciones aprobadas"
                    </div>
                    <div class="question" onclick="testIntent('¬øPor qu√© se aprob√≥?')">
                        "¬øPor qu√© se aprob√≥?"
                    </div>
                </div>
                <button onclick="testIntent('¬øCu√°ntas excepciones?')">üß™ Probar Intent 3</button>
                <div id="status-3" class="status" style="display: none;"></div>
            </div>

            <!-- Test 4: Aprobados -->
            <div class="test-card">
                <h3>‚úÖ Aprobados</h3>
                <span class="intent-label">Intent #4</span>
                <div class="questions">
                    <div class="question" onclick="testIntent('¬øCu√°ntas facturas aprobadas?')">
                        "¬øCu√°ntas facturas aprobadas?"
                    </div>
                    <div class="question" onclick="testIntent('¬øQu√© fue aprobado?')">
                        "¬øQu√© fue aprobado?"
                    </div>
                    <div class="question" onclick="testIntent('Facturas revisadas')">
                        "Facturas revisadas"
                    </div>
                </div>
                <button onclick="testIntent('¬øCu√°ntas facturas aprobadas?')">üß™ Probar Intent 4</button>
                <div id="status-4" class="status" style="display: none;"></div>
            </div>

            <!-- Test 5: Info Proveedor -->
            <div class="test-card">
                <h3>üìã Info Proveedor</h3>
                <span class="intent-label">Intent #5</span>
                <div class="questions">
                    <div class="question" onclick="testIntent('Informaci√≥n de Proveedor A')">
                        "Informaci√≥n de Proveedor A"
                    </div>
                    <div class="question" onclick="testIntent('¬øQu√© s√© del RUT 12.345.678-9?')">
                        "¬øQu√© s√© del RUT 12.345.678-9?"
                    </div>
                    <div class="question" onclick="testIntent('Datos de Empresa X')">
                        "Datos de Empresa X"
                    </div>
                </div>
                <button onclick="testIntent('Informaci√≥n de Proveedor A')">üß™ Probar Intent 5</button>
                <div id="status-5" class="status" style="display: none;"></div>
            </div>

            <!-- Test 6: Help (Fallback) -->
            <div class="test-card">
                <h3>‚ùì Help / Fallback</h3>
                <span class="intent-label">Intent #6 (Fallback)</span>
                <div class="questions">
                    <div class="question" onclick="testIntent('Hola')">
                        "Hola"
                    </div>
                    <div class="question" onclick="testIntent('¬øCu√°les son tus poderes?')">
                        "¬øCu√°les son tus poderes?"
                    </div>
                    <div class="question" onclick="testIntent('Ayuda')">
                        "Ayuda"
                    </div>
                </div>
                <button onclick="testIntent('Hola')">üß™ Probar Help</button>
                <div id="status-6" class="status" style="display: none;"></div>
            </div>
        </div>

        <!-- Chat Preview -->
        <div class="chat-preview">
            <h2>üí¨ Chat Interactivo</h2>
            <div class="chat-window" id="chat-window"></div>
            <div class="input-area">
                <input type="text" id="chat-input" placeholder="Escribe tu pregunta aqu√≠..." onkeypress="if(event.key === 'Enter') sendMessage()">
                <button onclick="sendMessage()">Enviar</button>
            </div>
        </div>

        <!-- Results Summary -->
        <div class="results-summary">
            <h2>üìä Resumen de Pruebas</h2>
            <div id="results-container">
                <p style="color: #999;">Los resultados aparecer√°n aqu√≠ despu√©s de hacer pruebas</p>
            </div>
        </div>
    </div>

    <script>
        // Estado de pruebas
        const testResults = {
            'riesgo_critico': null,
            'deuda_total': null,
            'excepciones': null,
            'aprobados': null,
            'proveedor_info': null,
            'help': null
        };

        // Simular el motor de detecci√≥n de intents (copiado de chatbot.js)
        function detectIntent(text) {
            const lowerText = text.toLowerCase();

            // Intent 1: Riesgo Cr√≠tico
            if (lowerText.includes('cr√≠tico') || lowerText.includes('critico') || 
                lowerText.includes('bloqueado') || lowerText.includes('riesgo')) {
                return 'riesgo_critico';
            }

            // Intent 2: Deuda Total
            if (lowerText.includes('deuda') || lowerText.includes('debo') || 
                lowerText.includes('monto') || lowerText.includes('total')) {
                return 'deuda_total';
            }

            // Intent 3: Excepciones
            if (lowerText.includes('excepci√≥n') || lowerText.includes('excepcion') || 
                lowerText.includes('aprob√≥') || lowerText.includes('supervisa')) {
                return 'excepciones';
            }

            // Intent 4: Aprobados
            if (lowerText.includes('aprobad') || lowerText.includes('revisad') || 
                lowerText.includes('aceptad')) {
                return 'aprobados';
            }

            // Intent 5: Info Proveedor
            if (lowerText.includes('proveedor') || lowerText.includes('empresa') || 
                lowerText.includes('rut') || lowerText.includes('informaci√≥n') || 
                lowerText.includes('informacion')) {
                return 'proveedor_info';
            }

            // Fallback: Help
            return 'help';
        }

        // Simular respuestas (datos ficticios para paso 2)
        function getResponse(intent) {
            const responses = {
                'riesgo_critico': {
                    title: '‚ö†Ô∏è Facturas en Riesgo Cr√≠tico',
                    content: 'Detectado 2 facturas en RIESGO CR√çTICO:\n\nüö´ DTE #2 - Empresa Fantasma\nScore: 100/100\nMonto: $5,000,000\n\nüö´ DTE #5 - Proveedor Dudoso\nScore: 95/100\nMonto: $3,200,000'
                },
                'deuda_total': {
                    title: 'üí∞ Deuda Total',
                    content: 'DEUDA TOTAL CALCULADA:\n\nMonto Total: $52,800,000\nProveedores: 5\nFacturas: 5\nPromedio por factura: $10,560,000'
                },
                'excepciones': {
                    title: '‚ö†Ô∏è Excepciones Aprobadas',
                    content: 'EXCEPCIONES APROBADAS: 1\n\nüìã DTE #2 - Empresa Fantasma\nJustificaci√≥n: Cliente importante - verificado por CEO\nFecha: 8/11/2025'
                },
                'aprobados': {
                    title: '‚úÖ Facturas Aprobadas',
                    content: 'FACTURAS APROBADAS: 3\n\n‚úì DTE #1\nComentario: Verificado con proveedor\nFecha: 8/11/2025\n\n‚úì DTE #3\nComentario: OK'
                },
                'proveedor_info': {
                    title: 'üìã Informaci√≥n de Proveedor',
                    content: 'PROVEEDOR: Proveedor A S.A.\n\nRUT: 12.345.678-9\nRegi√≥n: Metropolitana\nFacturas: 1\nMonto Total: $5,000,000\n\nüìä RIESGO: BAJO (10/100)'
                },
                'help': {
                    title: '‚ùì Ayuda',
                    content: '¬°Hola! Soy CAI, tu asistente contable. Puedo ayudarte con:\n\n1. ¬øCu√°ntas facturas en riesgo cr√≠tico?\n2. ¬øCu√°l es la deuda total?\n3. ¬øExcepciones aprobadas?\n4. ¬øFacturas aprobadas?\n5. Informaci√≥n de proveedores\n\n¬øQu√© necesitas?'
                }
            };

            return responses[intent] || responses['help'];
        }

        // Probar un intent
        function testIntent(question) {
            const intent = detectIntent(question);
            const response = getResponse(intent);
            
            // Actualizar UI
            addChatMessage('user', question);
            setTimeout(() => {
                addChatMessage('bot', response.content);
            }, 500);

            // Guardar resultado
            testResults[intent] = {
                question: question,
                intent: intent,
                response: response,
                timestamp: new Date()
            };

            // Mostrar estado
            showTestStatus(intent);
            updateResultsSummary();
        }

        // Enviar mensaje desde chat
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const question = input.value.trim();

            if (!question) return;

            addChatMessage('user', question);
            input.value = '';

            setTimeout(() => {
                const intent = detectIntent(question);
                const response = getResponse(intent);
                addChatMessage('bot', response.content);

                testResults[intent] = {
                    question: question,
                    intent: intent,
                    response: response,
                    timestamp: new Date()
                };

                updateResultsSummary();
            }, 500);
        }

        // Agregar mensaje al chat
        function addChatMessage(type, content) {
            const chatWindow = document.getElementById('chat-window');
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.textContent = content;
            chatWindow.appendChild(message);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        // Mostrar estado de prueba
        function showTestStatus(intent) {
            const intentMap = {
                'riesgo_critico': '1',
                'deuda_total': '2',
                'excepciones': '3',
                'aprobados': '4',
                'proveedor_info': '5',
                'help': '6'
            };

            const statusId = `status-${intentMap[intent]}`;
            const statusDiv = document.getElementById(statusId);
            
            statusDiv.className = 'status success';
            statusDiv.textContent = `‚úì Intent detectado: ${intent}`;
            statusDiv.style.display = 'block';

            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
        }

        // Actualizar resumen de pruebas
        function updateResultsSummary() {
            const container = document.getElementById('results-container');
            const tested = Object.values(testResults).filter(r => r !== null);

            if (tested.length === 0) {
                container.innerHTML = '<p style="color: #999;">Los resultados aparecer√°n aqu√≠ despu√©s de hacer pruebas</p>';
                return;
            }

            let html = `<p><strong>Pruebas ejecutadas: ${tested.length}</strong></p>`;

            tested.forEach(result => {
                html += `
                    <div class="result-item pass">
                        <span class="result-icon">‚úì</span>
                        <div>
                            <strong>${result.response.title}</strong>
                            <br><small>Intent: ${result.intent} | Pregunta: "${result.question}"</small>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Mensaje de bienvenida
        window.addEventListener('DOMContentLoaded', () => {
            addChatMessage('bot', '¬°Hola! Soy CAI, tu asistente contable. Prueba los botones arriba o hazme una pregunta aqu√≠. üòä');
        });
    </script>
</body>
</html>
